Adding on from the previous steps of CT-scans by including void porosity analysis. 

# 3D CT Image Void Analysis Toolkit

This repository contains a set of MATLAB scripts designed for analyzing the porosity and void characteristics of 3D binary volumes, typically derived from CT scan data. The scripts calculate local porosity, void diameters, and individual void shape descriptors like sphericity and compactness.

## Features

-   **Local Porosity Mapping:** Calculates porosity within a sliding 3D window to create a spatial map of material density.
-   **Void Size Analysis:** Estimates the diameter of voids at each point in the volume.
-   **Individual Void Shape Analysis:** Identifies discrete voids and computes shape metrics (sphericity, compactness) for each one.
-   **Rich Visualization:** Generates histograms, 2D slice maps, and 3D scatter plots to visualize the results.

## Requirements

-   **MATLAB**
-   **MATLAB Image Processing Toolboxâ„¢**: Required for functions like `bwconncomp` and `regionprops3`.

## How to Use

The analysis is performed in two main steps using the provided scripts.

### Step 1: Run `void_analysis.m`

This script performs the local, voxel-by-voxel analysis.

1.  Place your 3D binary data (where material=1, void=0) into a `.mat` file.
2.  Open `void_analysis.m` in MATLAB.
3.  **Change the input file by editing a single line.** Modify the `type` variable to match the name of your `.mat` file.

    ```matlab
    % Change to the desired type
    type = '0_90_40kV_250uA_16um_res_rec'; 
    load([type, '.mat']); % This line will load your data
    ```
    For example, if your data is in a file named `my_sample.mat`, you would change the line to:
    ```matlab
    type = 'my_sample';
    ```

4.  Run the script. It will generate and save a new `.mat` file containing the porosity and diameter maps, and it will produce two figures.

### Step 2: Run `void_shape_analysis.m`

This script analyzes the shape of each individual void in the entire volume.

1.  Make sure the `BW` variable from your data is loaded into the MATLAB workspace (running `void_analysis.m` first will do this).
2.  Run the `void_shape_analysis.m` script.
    ```matlab
    void_shape_analysis
    ```
3.  The script will automatically find the `BW` variable and perform the analysis, generating two more figures.

## Code Description

### `void_analysis.m`

This script uses a **sliding window (kernel)** approach to analyze local properties.
-   It loads a 3D binary matrix (`BW`).
-   It iterates through the matrix using a 3D kernel of a specified size (`n x n x n`).
-   At each position, it calculates:
    -   **Local Porosity:** The fraction of void voxels (0s) within the kernel.
    -   **Local Void Diameter:** An estimated diameter of the void space within the kernel, calculated by assuming the void voxels form a sphere.
-   The results are saved and visualized.

### `void_shape_analysis.m`

This function identifies all unique, connected void regions and calculates their geometric properties.
-   It takes the full `BW` matrix as input.
-   Using `bwconncomp`, it finds every separate void.
-   For each void, it uses `regionprops3` to measure its `Volume`, `SurfaceArea`, and `PrincipalAxisLength`.
-   It then calculates two key shape metrics:
    -   **Sphericity:** A measure of how closely the void's shape resembles a perfect sphere. A value of 1 indicates a perfect sphere.
    -   **Compactness:** A normalized ratio of the void's volume to its maximum length.

## Results & Visualizations

The scripts generate four main figures to help interpret the data.

### 1. Void Shape Descriptor Distributions

**(Generated by `void_shape_analysis.m`)**

This figure shows the distribution of shape metrics across all detected voids.
-   **Left (Sphericity):** Shows how many voids fall into different sphericity bins. A peak towards 1.0 indicates predominantly spherical voids.
-   **Right (Compactness):** Shows the distribution of the volume-to-length ratio.

![Void Shape Descriptors](documentation_images/Void_Shape_Descriptions.png)

### 2. Example 3D Voids

**(Generated by `void_shape_analysis.m`)**

This figure displays 3D scatter plots of a few example voids, chosen because they are the most spherical. Each point is a voxel belonging to that void. The color of the points corresponds to the void's sphericity value, providing a quick visual confirmation of the shape metric.

![Example Voids 3D Scatter](documentation_images/Example_Voids_3D_Scatter.png)

### 3. Local Void Diameter Map

**(Generated by `void_analysis.m`)**

This figure shows a 2D slice from the middle of the 3D volume. The color at each pixel represents the estimated diameter of the local void space at that position. This map is useful for identifying regions with larger or smaller voids.

![Local Void Diameter Slice](documentation_images/Local_Void_Diameter.png)

### 4. Histogram of Local Void Diameters

**(Generated by `void_analysis.m`)**

This histogram shows the frequency distribution of all the local void diameters calculated across the entire volume. It gives a high-level summary of the characteristic void size in the material.

![Histogram of Local Void Diameters](documentation_images/Histogram_Local_Void_Diameters.png)
